var portalApp=angular.module("portalApp",["ui.router","portalApp.client","portalApp.jobs","portalApp.company","portalApp.search","portalApp.applications"]),baseApi="/api/";portalApp.run(["$rootScope",function(e){e.User=User,e.originalUserName=User.name,e.isLoggedIn=!1}]),portalApp.config(["$httpProvider",function(e){e.interceptors.push("httpInterceptor")}]),portalApp.run(["$transitions",function(e){e.onStart({to:"client"},function(e){if(2!==User.role)return e.router.stateService.target("login")})}]),portalApp.config(["$stateProvider","$urlRouterProvider",function(e,t){t.when("","/login"),e.state("client",{url:"/client",templateUrl:"/templates/client.html",controller:"ClientController"}),e.state("jobs",{url:"/jobs",templateUrl:"/templates/jobs.html",controller:"JobsController"}),e.state("jobdetails",{url:"/jobs/details/:id",params:{details:null},templateUrl:"/templates/job-details.html",controller:"JobDetailsController"}),e.state("company",{url:"/company/:id",templateUrl:"/templates/company.html",controller:"CompanyController"}),e.state("search",{url:"/search?keyword",templateUrl:"/templates/search.html",controller:"SearchController"}),e.state("login",{url:"/login",templateUrl:"/templates/login.html",controller:"LoginController"}),e.state("applications",{url:"/applications",templateUrl:"/templates/applications.html",controller:"ApplicationsController"})}]),portalApp.controller("MainController",["$scope","$state",function(e,t){e.stateName=t.current.name,e.handleSearch=function(){e.search&&t.go("search",{keyword:e.search})}}]),portalApp.controller("LoginController",["$scope","$rootScope","$state",function(e,t,o){e.loginAs=function(r){t.isLoggedIn=!0,User.role=r,2===User.role?(o.go("client"),User.name=e.originalUserName+" HR"):(o.go("jobs"),User.name=e.originalUserName)}}]),portalApp.directive("preloader",[function(){return{restrict:"E",template:"Loading..."}}]),portalApp.directive("ifEmpty",[function(){return{restrict:"A",transclude:!0,scope:{ifEmpty:"="},template:'<div class="clr center align-preloader" ng-if="loading"><preloader></preloader></div><div class="text-center" ng-if="empty && !loading"><h4 class="mrgtb10"> {{message}} </h4></div><ng-transclude ng-if="!empty && !loading"></ng-transclude>',link:function(e,t,o){e.$watch("ifEmpty",function(){angular.isDefined(e.ifEmpty)?(e.empty=0===e.ifEmpty.length,e.loading=!1):(e.empty=!0,e.loading=!0)},!0),e.message=o.message?o.message:"No Data available.",t.on("$destroy",function(){e.$destroy()})}}}]),portalApp.factory("httpInterceptor",["StatusMessageService",function(e){return{request:function(e){return e},requestError:function(e){return e},response:function(e){return e},responseError:function(t){return e.showErrorMessage(t.statusText,t),t}}}]),portalApp.factory("CacheAPIService",["$http",function(e){var t={};return{get:function(o){return angular.isDefined(t[o])?(console.log("Serving ",o," request from cache"),t[o]):(t[o]=e.get(baseApi+o),t[o])},delete:function(e){delete t[e]}}}]),portalApp.factory("StatusMessageService",["$rootScope","$timeout",function(e,t){var o={};return{showSuccessMessage:function(r,a,n,s){o.message=r,o.class="alert-success",e.statusMessage=o,t(function(){delete e.statusMessage},2500)},showErrorMessage:function(r,a){o.message=r||"Error Occured",o.class="alert-danger",e.statusMessage=o,t(function(){delete e.statusMessage},2e3)}}}]),portalApp.factory("ApplicationService",["$http",function(e){var t=baseApi+"jobs/applications/";return{applyForThisJob:function(o,r){var a={JobPost:o,User:r};return e.post(t+"apply/"+o.id,a)},fetchMyApplications:function(o){return e.get(t+"user/"+o)},fetchThisJobPostApplications:function(o){return e.get(t+"post/"+o)},fetchClientsApplications:function(o){return e.get(t+"client/"+o)},shortlistCandidate:function(o,r){return e.put(t+"shortlist/post/"+o+"/candidate/"+r)}}}]),portalApp.jobs=angular.module("portalApp.jobs",[]),portalApp.jobs.controller("JobsController",["$http","$scope","ApplicationService","StatusMessageService",function(e,t,o,r){e.get(baseApi+"jobs").then(function(e){t.allJobs=e.data},function(e){console.log("err occured",e)}),t.applyForThisJob=function(e){o.applyForThisJob(e,User).then(function(t){200===t.data.code?r.showSuccessMessage(t.data.message):r.showErrorMessage(t.data.message),e.applied=!0},function(e){console.log("Error Occured, error = ",e)})}}]),portalApp.jobs.controller("JobDetailsController",["CacheAPIService","$scope","$stateParams","ApplicationService","StatusMessageService",function(e,t,o,r,a){o.details?t.details=o.details:e.get("jobs/"+o.id).then(function(e){t.details=e.data},function(e){console.log("err occured",e)}),t.applyForThisJob=function(){r.applyForThisJob(t.details,User).then(function(e){200===e.data.code?a.showSuccessMessage(e.data.message):a.showErrorMessage(e.data.message),t.details.applied=!0},function(e){console.log("Error Occured, error = ",e)})}}]),portalApp.client=angular.module("portalApp.client",[]),portalApp.client.controller("ClientController",["$scope","CacheAPIService","$http","StatusMessageService","$state","$timeout",function(e,t,o,r,a,n){function s(){if(!(e.formData.keywords instanceof Array)){for(var t=e.formData.keywords.split(","),o=[],r=0;r<t.length;r++){var a=t[r];a=a.trim(),o.push(a)}e.formData.keywords=o}}function l(){o.post(baseApi+"jobs",e.formData).then(function(e){r.showSuccessMessage(e.data.message),n(function(){a.go("jobs")},500)},function(e){console.log("ERROR: ",e)})}t.get("companies").then(function(t){e.companies=t.data,e.formData.Company=e.companies[4]}),e.options={education:["B.Tech","MS","BCA","MCA","PHD"],status:[{id:1,value:"Open"},{id:2,value:"Closed"}]};var i=new Date;i.setDate(i.getDate()+7),e.formData={title:"Member Technical Staff",createdBy:User,domain:"Business Software | Cloud",education:["B.Tech","MCA"],description:"Full stack developer involved in all phases of development",location:"Chennai",status:1,keywords:["SaaS","Cloud","Business","Software"],lastDate:i},e.submitForm=function(){s(),l()}}]),portalApp.company=angular.module("portalApp.company",[]),portalApp.company.controller("CompanyController",["CacheAPIService","$scope","$stateParams",function(e,t,o){e.get("companies/"+o.id).then(function(e){t.company=e.data},function(e){console.log("err occured",e)}),t.showJobsLink=!0}]),portalApp.search=angular.module("portalApp.search",[]),portalApp.search.controller("SearchController",["$http","$scope","$stateParams",function(e,t,o){e.get(baseApi+"search?keyword="+o.keyword).then(function(e){t.allJobs=e.data.jobs,t.companies=e.data.companies},function(e){console.log("err occured",e)})}]),portalApp.applications=angular.module("portalApp.applications",[]),portalApp.applications.controller("ApplicationsController",["CacheAPIService","$scope","$stateParams","ApplicationService",function(e,t,o,r){(1==User.role?r.fetchMyApplications(User.id):r.fetchClientsApplications(User.id)).then(function(e){t.applications=e.data},function(e){console.log("Error occured!, err=",e)}),t.shortlistCandidate=function(e){r.shortlistCandidate(e.JobPost.id,e.User.id).then(function(t){e.isShortlisted=t.data.isShortlisted},function(e){console.log("Error occured, err=",e)})}}]);